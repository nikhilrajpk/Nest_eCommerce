{% extends 'admin_app/admin_base.html' %}
{% load static %}
{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
<br><br>
<div class="container mt-5">
<!-- breadcrumbs start-->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'admin_app:admin_product' %}">Product</a></li>
    <li class="breadcrumb-item"><a href="">Add product</a></li>
    </ol>
</nav>
    <h2 class="mb-4">Add New Product</h2>
    <form action="" method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="mb-3">
            <label for="product-name" class="form-label">Product Name:</label>
            <input type="text" class="form-control" id="product-name" name="product_name" required>
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Description:</label>
            <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">Price:</label>
            <input type="number" step="0.01" class="form-control" id="price" name="price" required>
        </div>
        
        <div class="mb-3">
            <label for="offer" class="form-label">Offer:</label>
            <select class="form-select" id="offer" name="offer">

                <option value="">None</option>
                {% for offer in offers %}
                    <option value="{{ offer.id }}">{{ offer.offer_title }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="category" class="form-label">Category:</label>
            <select class="form-select" id="category" name="category" required>

                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.category_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="available-stock" class="form-label">Available Stock:</label>
            <input type="number" class="form-control" id="available-stock" name="available_stock" min="0" required>
        </div>

        <div class="mb-3">
            <label for="image-1" class="form-label">Image 1:</label>
            <input type="file" class="form-control image-input" id="image-1" name="image_1" accept="image/*" required>
        </div>

        <div class="mb-3">
            <label for="image-2" class="form-label">Image 2:</label>
            <input type="file" class="form-control image-input" id="image-2" name="image_2" accept="image/*" required>
        </div>

        <div class="mb-3">
            <label for="image-3" class="form-label">Image 3:</label>
            <input type="file" class="form-control image-input" id="image-3" name="image_3" accept="image/*" required>
        </div>

        <!-- Modal for cropping -->
        <div id="cropperModal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Crop Image</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                <img id="cropperImage" src="" alt="Crop Image Preview" style="max-width: 100%;">
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="cropImage()">Crop</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="is-listed" class="form-label">Is Listed:</label>
            <select class="form-select" id="is-listed" name="is_listed" required>
                <option value="True">Yes</option>
                <option value="False">No</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="in-stock" class="form-label">In Stock:</label>
            <select class="form-select" id="in-stock" name="in_stock" required>
                <option value="True">Yes</option>
                <option value="False">No</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="material" class="form-label">Material:</label>
            <input type="text" class="form-control" id="material" name="material">
        </div>

        <div class="mb-3">
            <label for="color" class="form-label">Color:</label>
            <input type="text" class="form-control" id="color" name="color">
        </div>
        <div class="mb-3">
            <label for="width" class="form-label">Width:</label>
            <input type="text" class="form-control" id="width" name="width">
        </div>
        <div class="mb-3">
            <label for="length" class="form-label">Length:</label>
            <input type="text" class="form-control" id="length" name="length">
        </div>
        <div class="mb-3">
            <label for="height" class="form-label">Height:</label>
            <input type="text" class="form-control" id="height" name="height">
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">Add Product</button>
    </form>
</div>
<br><br>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<script>
    let cropper;
let activeInput;

document.querySelectorAll('.image-input').forEach(input => {
  input.addEventListener('change', function() {
    const file = this.files[0];
    activeInput = this;  // Store reference to the active input
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('cropperImage').src = e.target.result;
        $('#cropperModal').modal('show');

        if (cropper) {
          cropper.destroy();
        }

        cropper = new Cropper(document.getElementById('cropperImage'), {
          aspectRatio: 1,
          viewMode: 1,
        });
      };
      reader.readAsDataURL(file);
    }
  });
});

function cropImage() {
  if (cropper && activeInput) {
    const canvas = cropper.getCroppedCanvas();
    canvas.toBlob((blob) => {
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(new File([blob], 'cropped_image.png', { type: 'image/png' }));
      activeInput.files = dataTransfer.files;

      $('#cropperModal').modal('hide');
    });
  }
}

</script>
{% endblock content %}